From 93e063ee374b6a75729df9e7201fb511e47e259d Mon Sep 17 00:00:00 2001
From: Christos Zoulas <christos@zoulas.com>
Date: Mon, 9 Jun 2014 13:04:37 +0000
Subject: [PATCH] Add missing check offset test (Francisco Alonso, Jan Kaluza
 at RedHat)

---
 src/cdf.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

Index: file-5.14/src/cdf.c
===================================================================
--- file-5.14.orig/src/cdf.c	2014-07-10 09:28:51.894565389 -0400
+++ file-5.14/src/cdf.c	2014-07-10 09:28:51.890565389 -0400
@@ -799,7 +799,11 @@
 	if (cdf_check_stream_offset(sst, h, e, 0, __LINE__) == -1)
 		goto out;
 	for (i = 0; i < sh.sh_properties; i++) {
-		size_t ofs = CDF_GETUINT32(p, (i << 1) + 1);
+		size_t tail = (i << 1) + 1;
+		if (cdf_check_stream_offset(sst, h, p, tail * sizeof(uint32_t),
+		    __LINE__) == -1)
+			goto out;
+		size_t ofs = CDF_GETUINT32(p, tail);
 		q = (const uint8_t *)(const void *)
 		    ((const char *)(const void *)p + ofs
 		    - 2 * sizeof(uint32_t));
